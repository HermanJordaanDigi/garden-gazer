# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Garden Gazer is a React-based plant nursery catalog application. Users can browse plants, filter by attributes (type, sun exposure, wind tolerance), view detailed plant information, upload images, and track purchased plants in their collection. Built with Lovable (lovable.dev) and deployed from that platform.

## Tech Stack

- **Frontend**: React 18 + TypeScript + Vite
- **Routing**: React Router v6
- **UI Components**: shadcn/ui (Radix UI primitives + Tailwind CSS)
- **Styling**: Tailwind CSS with custom theme (primary color: #386641)
- **State Management**: TanStack Query (React Query) for server state
- **Forms**: React Hook Form + Zod validation
- **Backend**: Supabase (PostgreSQL database)
- **External Integration**: n8n webhook for adding new plants

## Commands

```bash
# Development
npm run dev          # Start dev server (Vite)

# Build
npm run build        # Production build
npm run build:dev    # Development mode build
npm run preview      # Preview production build

# Code Quality
npm run lint         # Run ESLint
```

## Architecture

### Data Flow

1. **Database**: Supabase table `nurserydb` stores all plant data
2. **Query Layer**: `src/hooks/usePlantsQuery.ts` handles all data fetching with TanStack Query
3. **Fallback**: If Supabase fails, falls back to `SAMPLE_PLANTS` in `src/types/plant.ts`

### Key Hooks

- **usePlantsQuery**: Infinite scroll query with filtering, sorting, and pagination (20 items/page)
  - Supports filters: `search`, `type`, `sunExposure`, `windTolerance`, `floweringSeason`, `bought`
  - Supports sorting by: `common_name`, `price`, `id`
- **usePlantById**: Fetch single plant by ID
- **useUpdatePlantImage**: Mutation to update plant images (stored as array in DB)
- **useMarkAsBought**: Mutation to mark plants as purchased

### Pages & Routes

Routing configured in [src/App.tsx](src/App.tsx):

- `/` - [Index.tsx](src/pages/Index.tsx): Main plant grid with filters/sort, toggle between "Searches" (all plants) and "Collection" (bought plants)
- `/plant/:id` - [PlantDetail.tsx](src/pages/PlantDetail.tsx): Detailed plant view with image upload
- `/add-plant` - [AddPlant.tsx](src/pages/AddPlant.tsx): Form to submit new plants via n8n webhook
- `*` - [NotFound.tsx](src/pages/NotFound.tsx): 404 page

### State Management Pattern

- **Server State**: TanStack Query handles all API data (caching, invalidation, refetching)
- **UI State**: Local React state (`useState`) for filters, sort, view mode
- **No Global Store**: Application uses query cache as source of truth

### Image Handling

Images are resized client-side ([src/lib/imageResize.ts](src/lib/imageResize.ts)) before upload:
- Max dimensions: 1200x1200px
- Maintains aspect ratio
- JPEG quality: 85%
- Uploaded to Supabase storage, URL stored in `images` array field

### Styling Patterns

- **Theme Color**: `#386641` (green) used in header background, badges
- **Header**: Sticky header with `#738678` background, white text
- **Components**: shadcn/ui components in `src/components/ui/` (auto-generated, avoid editing)
- **Custom Components**: `PlantCard`, `FilterChips`, `InfoTile`, `PlantSkeleton`

### Database Schema

The `nurserydb` table has these key fields:
- `id`: Primary key
- `scientific_name`, `common_name`: Text
- `native_region`, `type`, `soil_type`, `sun_exposure`, `wind_tolerance`, `growth_habit`, `mature_height_width`, `flowering_season`, `flower_colour`: Text
- `images`: Text array
- `price`: Numeric
- `bought`: Boolean (for collection tracking)

## Important Patterns

### Infinite Scroll Implementation

Uses `react-intersection-observer` + TanStack Query infinite queries:
```tsx
const { ref, inView } = useInView();
const { data, fetchNextPage, hasNextPage } = usePlantsQuery();

useEffect(() => {
  if (inView && hasNextPage && !isFetchingNextPage) {
    fetchNextPage();
  }
}, [inView, hasNextPage, isFetchingNextPage]);
```

### Query Invalidation

After mutations, invalidate both specific item and list queries:
```tsx
queryClient.invalidateQueries({ queryKey: ['plant', id] });
queryClient.invalidateQueries({ queryKey: ['plants'] });
```

### External API Integration

New plants submitted to n8n webhook at `https://jordaandigi.app.n8n.cloud/webhook/text_input` with `scientific_name` and optional `price`.

## Development Notes

- **Supabase Config**: Connection details in [src/integrations/supabase/client.ts](src/integrations/supabase/client.ts) (auto-generated by Lovable)
- **Types**: Database types auto-generated in `src/integrations/supabase/types.ts`
- **Main Entry**: [src/main.tsx](src/main.tsx) renders [src/App.tsx](src/App.tsx)
- **shadcn/ui**: Component configurations in [components.json](components.json)

## Color Utilities

[src/lib/color.ts](src/lib/color.ts) provides `parseFlowerColors()` to map flower color text to hex codes and `formatPrice()` for Euro formatting.
